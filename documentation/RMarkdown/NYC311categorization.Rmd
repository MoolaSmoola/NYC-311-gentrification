---
title: "NYC311categorization"
author: "Benet Ge"
date: "2023-07-11"
output: 
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Categorizing NYC311 complaints into 6 groups

We're going to begin by reading in the csv generated by the last RMD. That csv was generated with write.csv2 because there were commas in the observations under the "geometry" variable. As a result, we are reading this csv now by separating by ";" and not the default ",".

```{r libraries, include=FALSE}
library(dplyr)
library(stringr)
```

```{r reading and viewing data, cache = TRUE}
NYC311b2bg <- read.csv(file = "/Users/benetge/Downloads/57/NYC311datafiles/pared block group data/paredbg_b_test.csv", sep=";")
NYC311b2bg <- NYC311b2bg[,-1]
head(NYC311b2bg, n=10)
```

Next, we're going to label the data based on the appropriate complaint category. For now, we are using 6 categories:

* In building noise (parties, talking, music, television), designated with [0]
* Exterior noise from people, designated with [1]
* Exterior noise from other, designated with [2]
* Parking, designated with [3]
* Junk or debris, designated with [4]
* Other, designated with [5]

This is a working document, which means that I am going to document these designations here so that we may reference and adjust them in the future. 

## Notes for pared block group part b, with 102 unique complaint/descriptor combos & 29 types:

* Noise - Residential is always 0
* Q: Building/Use is almost always directed towards illegal behavior? Also Graffiti & Smoking. These are controversial behaviors, should it just be "Other"? These are the real conflicts/differences in belief. Governance? Trespassing is under this. Drinking in Public?
* Q: Is derelict vehicle 3 or 4? I've momentarily put it at 4. Because e.g. "With License Plate" descriptor for derelict vehicle seems like a behavioral complaint
* Q: Is noise from vehicle 1 or 2? I've put "Car/Truck Music" under 1 & Engine Idling there too, but...? Is it 2? Car/Truck Horn too.
* Q: Illegal Tree Damage has Trunk Damage, which I'm not even sure is a social conflict. Momentarily under 5.
* Q: Is noise from commercial & house of worship 1 or 2? Momentarily they've been assigned 1.
* Q: Homeless Person Assistance / No Status Call & Status Call should probably be filtered out? Have to figure out what it refers to. Momentarily 5.
* Q: Also questioning the severity of "Illegal Animal Kept as Pet"
* Q: If bored, since "5" takes up the bulk I could also make the code a TRUE ~ "5" to be savvy.

But here's the code before resolving all these notes:

```{r searching for complaints and assigning a value for the mutated category column, cache = TRUE}
NYCmutatebfinal <- NYC311b2bg %>% 
  mutate(complaintcategory = case_when(str_detect(complainttype, "Noise - Residential")~ "0",
                                  str_detect(complainttype, "Blocked Driveway") ~ "3",
                                  str_detect(complainttype, "Noise - Commercial") ~ "1",
                                  str_detect(complainttype, "Building/Use") ~ "5",
                                  str_detect(complainttype, "Graffiti") ~ "5",
                                  str_detect(complainttype, "Noise - Street/Sidewalk") ~ "1",
                                  str_detect(complainttype, "Derelict Vehicle") ~ "4",
                                  str_detect(complainttype, "Illegal Parking") ~ "3",
                                  str_detect(complainttype, "Noise - Vehicle") ~ "1",
                                  str_detect(complainttype, "Non-Emergency Police Matter") ~ "5",
                                  str_detect(complainttype, "Noise - Park") ~ "1",
                                  str_detect(complainttype, "Smoking") ~ "5",
                                  str_detect(complainttype, "Unsanitary Animal Pvt Property") ~ "5",
                                  str_detect(complainttype, "Illegal Tree Damage") ~ "5",
                                  str_detect(complainttype, "Derelict Bicycle") ~ "4",
                                  str_detect(complainttype, "Drinking") ~ "5",
                                  str_detect(complainttype, "Noise - House of Worship") ~ "1",
                                  str_detect(complainttype, "Disorderly Youth") ~ "5",
                                  str_detect(complainttype, "Bike/Roller/Skate Chronic") ~ "5",
                                  str_detect(complainttype, "Urinating in Public") ~ "5",
                                  str_detect(complainttype, "Illegal Fireworks") ~ "5",
                                  str_detect(complainttype, "Homeless Person Assistance") ~ "5",
                                  str_detect(complainttype, "Animal Abuse") ~ "5",
                                  str_detect(complainttype, "Panhandling") ~ "5",
                                  str_detect(complainttype, "Illegal Animal Kept as Pet") ~ "5",
                                  str_detect(complainttype, "Harboring Bees/Wasps") ~ "5",
                                  str_detect(complainttype, "Violation of Park Rules") ~ "5",
                                  str_detect(complainttype, "Illegal Animal Sold") ~ "5",
                                  str_detect(complainttype, "Squeegee") ~ "5"))

```

Next we're going to view it to check.
```{r viewing the complaintcategories, cache = TRUE}
NYCmutatebfinalrelevant <- NYCmutatebfinal[,c(1,46:48)]
head(NYCmutatebfinalrelevant, n=10)
```
# VoilÃ ! Now we're going to proceed by adding another column, categorizing relevance to social conflict. 

This was already sorted out in a xlsx sheet of tabulated complaint types that we manually assigned values to. 0 indicates irrelevance, 1 indicates medium relevance, 2 indicates sure relevance to social conflict. I'll import that here just for reference.

```{r tabulate the complainttype social conflict data for reference, cache=TRUE}
tabulate_complainttype <- read.csv(file = "/Users/benetge/Downloads/57/NYC311datafiles/complainttype_tabulate.csv")
head(tabulate_complainttype, n=34)
```

## Notes for the social conflict part, since I think we should review some of it in light of the categorizations:

* For the meantime I'm maintaining continuity by assigning according to the original xlsx.
* Also, there's no "Drug Activity" in part b, even though I "keep" the data in STATA. Look at other downloaded groups and see if something's up
* Q: Should all the noise types be changed to category 2? Meaning Noise - Commercial & Vehicle & House of Worship
* Q: Drug Activity and Disorderly Youth are under category 2 for social conflict despite being filed under category 5 - Other, this is probably evidence that we should disaggregate Other into two categories, where one is related to overtly behavioral conflicts/disagreements and one is truly miscellaneous, like "Illegal Animals..."

```{r searching for complaints and assigning a value based on social conflict level, cache = TRUE}
NYCmutatebsocialconflict <- NYCmutatebfinal %>% 
  mutate(complaintsocialconflict = case_when(str_detect(complainttype, "Noise - Residential")~ "2",
                                             str_detect(complainttype, "Blocked Driveway") ~ "1",
                                             str_detect(complainttype, "Noise - Commercial") ~ "1",
                                             str_detect(complainttype, "Building/Use") ~ "1",
                                             str_detect(complainttype, "Graffiti") ~ "1",
                                             str_detect(complainttype, "Noise - Street/Sidewalk") ~ "2",
                                             str_detect(complainttype, "Derelict Vehicle") ~ "1",
                                             str_detect(complainttype, "Illegal Parking") ~ "1",
                                             str_detect(complainttype, "Noise - Vehicle") ~ "1",
                                             str_detect(complainttype, "Non-Emergency Police Matter") ~ "1",
                                             str_detect(complainttype, "Noise - Park") ~ "2",
                                             str_detect(complainttype, "Smoking") ~ "1",
                                             str_detect(complainttype, "Unsanitary Animal Pvt Property") ~ "1",
                                             str_detect(complainttype, "Illegal Tree Damage") ~ "1",
                                             str_detect(complainttype, "Derelict Bicycle") ~ "1",
                                             str_detect(complainttype, "Drinking") ~ "1",
                                             str_detect(complainttype, "Noise - House of Worship") ~ "1",
                                             str_detect(complainttype, "Disorderly Youth") ~ "2",
                                             str_detect(complainttype, "Bike/Roller/Skate Chronic") ~ "1",
                                             str_detect(complainttype, "Urinating in Public") ~ "1",
                                             str_detect(complainttype, "Illegal Fireworks") ~ "1",
                                             str_detect(complainttype, "Homeless Person Assistance") ~ "1",
                                             str_detect(complainttype, "Animal Abuse") ~ "1",
                                             str_detect(complainttype, "Panhandling") ~ "1",
                                             str_detect(complainttype, "Illegal Animal Kept as Pet") ~ "1",
                                             str_detect(complainttype, "Harboring Bees/Wasps") ~ "1",
                                             str_detect(complainttype, "Violation of Park Rules") ~ "1",
                                             str_detect(complainttype, "Illegal Animal Sold") ~ "1",
                                             str_detect(complainttype, "Squeegee") ~ "1"))
```

Now, check it by viewing the data.
```{r viewing the complaint social conflict categories, cache = TRUE}
NYCmutatebsocialconflictrelevant <- NYCmutatebsocialconflict[,c(1,46:49)]
head(NYCmutatebsocialconflictrelevant, n=10)
```

# VoilÃ ! Now you've added complaint categories based on the type of complaint, as well as the relevance to social conflict! We can now conduct analyses, summarize, and regress based on different groups. I'm not including it in the code here but please remember to save this with `write.csv2`.